plot(CI = TRUE)
#' Plot a set of fitted distributions
#'
#' @param fit A [PCNMA::fitted_distribtuion] object
#' @param CI Include a confidence interval?
#' @param km Add the original KM curve?
#' @param km a dataframe with a surv column
#' @param ... For S3 consistency
#'
#' @export
plot.fitted_distribution <-  function(fit, CI = FALSE, km = FALSE, ...){
df <- as.data.frame(fit[["Model_Data"]])
names(df) <- c("time", "survival", "survival.lcl", "survival.ucl")
# Base plot, just the model
p <- ggplot(df, aes(x = time, y = survival))
if (CI) {
p <- p +
geom_ribbon(aes(x = time, ymin = survival.lcl, ymax = survival.ucl),
fill = "grey70")
}
# Add the model line and final cosmetic changes
p <- p +
geom_line() +
labs(x = "Time",
y = "Survival")
p
}
B |>
plot(CI = TRUE)
B |>
map(Plot = purrr::map(
Model_Data,
plot
))
B |>
mutate(Plot = purrr::map(
Model_Data,
plot
))
B |>
mutate(Plot = purrr::map(
Model_Data,
plot,
CI = TRUE
))
B |>
mutate(Plot = purrr::map(
Model_Data,
plot.fitted_distribution,
CI = TRUE
))
B <- fit_distribution(dists, testIPD)
B
B |>
mutate(Plot = purrr::map(
Model_Data,
plot.fitted_distribution,
CI = TRUE
))
renv::status
renv::status()
renv::install("ggraph")
renv::install("openxlsx")
renv::status()
??graphh
devtools::load_all()
ntwrk <- gen_network_data(openxlsx::read.xlsx("Data/DE.xlsx", "GEM"))
devtools::load_all()
ntwrk <- gen_network_data(openxlsx::read.xlsx("Data/DE.xlsx", "GEM"))
devtools::load_all()
ntwrk <- gen_network_data(openxlsx::read.xlsx("Data/DE.xlsx", "GEM"))
devtools::load_all()
ntwrk <- gen_network_data(openxlsx::read.xlsx("Data/DE.xlsx", "GEM"))
ntwrk <- gen_network_data(openxlsx::read.xlsx("Data/DE.xlsx"), "GEM"))
ntwrk <- gen_network_data(openxlsx::read.xlsx("Data/DE.xlsx"), "GEM")
library(readxl)
DE <- read_excel("Data/DE.xlsx", skip = 1)
View(DE)
ntwrk <- gen_network_data(DE, "GEM")
View(DE)
names(DE)
devtools::load_all()
ntwrk <- gen_network_data(DE, "GEM")
devtools::load_all()
ntwrk <- gen_network_data(DE, "GEM")
netwrk
netwrk
netwrk
ntwrk
class(ntwrk)
ntwrk <- gen_network_data(DE, "GEM")
ntwrk_data <- gen_network_data(DE, "GEM")
ntwrk <- gen_network(ntwrk_data)
ntwrk <- gen_network(ntwrk_data, "GEM")
#' Generate network data
#'
#' @param data A date extraction dataset
#' @param ref A character reference treatment
#'
#' @returns A dataframe
#'
#' @export
gen_network_data <- function(data, ref){
data |>  dplyr::select(Study, Year, "Total Patients", "Treatment 1",
"Treatment 2", "N (Trt1)", "N (Trt2)", "Reported OS", "Reported PFS") |>
dplyr::rename(N = "Total Patients") |>
dplyr::mutate(Study = paste0(Study, ", ", Year)) |>
tidyr::pivot_longer(cols = 4:5, values_to = "Treatment") |>
dplyr::mutate(r = ifelse(Treatment == ref, `N (Trt1)`, `N (Trt2)`)) |>
dplyr::select(-c(name, "N (Trt1)", "N (Trt2)"))
}
ntwrk_data <- gen_network_data(DE, "GEM")
ntwrk <- gen_network(ntwrk_data, "GEM")
ntwrk
class(ntwrk)
plot(ntwrk)
print(ntwrk)
?devtools::install_github
?github_token
devtools::load_all()
handle_IPD()
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
?group_by
devtools::load_all()
fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
plot(A)
plot(A)
devtools::load_all()
plot(A)
plot(A, km = TRUE)
summary(A)
B <- summary(A)
B
B <- summary(A, AIC = TRUE)
B
View(A)
coef(A)
coef(A$Model)
coef(A$Model[[1]])
coef(A$Model[1])
coef(A$Model[[2]])
devtools::load_all()
coef(A)
coef(A)
fit
A
class(A)
coef(A)
devtools::load_all()
handle_IPD()
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
plot(A, km = TRUE)
coef(A)
A |>
dplyr::select(Distribution, Model)
B <- A |>
dplyr::select(Distribution, Model)
View(IPD_GemOS_Colluci)
View(B)
tibble(B)
library(tibble)
tibble(B)
df <- A |> select(Distribution)
df <- A |> dplyr::select(Distribution)
View(df)
df <- A |> dplyr::select(Distribution) |>
purrr::map(A$Model, coef)
coef(A$Model)
coef(A$Model[[1]])
coef(A$Model[1])
coef(A$Model[[2]])
A <- purrr::map(A$Model, coef)
View(A)
data.frame(A)
#' Coefficients of fitted models
coef.fitted_distribution <- function(fit){
coefList <- purrr::map(fit$Model, coef)
coefList
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
coef(A)
B <- coef(A)
View(B)
as.data.frame(B)
as.data.frame(B, row.names = "Model", "Coefficient", "Value")
as.data.frame(B, row.names = c("Model", "Coefficient", "Value"))
rbind.data.frame(B)
?rbind.data.frame
rbind(B)
cbind(B)
?cbind
library(dplyr)
bind_rows(B)
?bind_rows
do.call(rbind.data.frame, B)
do.call(rbind.data.frame, B)
do.call(cbind.data.frame, B)
C <- do.call(rbind.data.frame, B)
View(C)
matrix(B)
matrix(B, ncols = 3)
?matrix
matrix(B, ncol = 3)
matrix(B, ncol = 3, nrow = 15)
matrix(B, ncol = 3, nrow = 14)
library(tidyr)
pivot_longer(B)
as.data.frame(B)
lapply(B, unlist)
C <- unlist(B)
C
pivot_longer(C)
C <- lapply(B, unlist)
View(C)
C$Exponential
C$Weibull
V
B
B |> as_tibble()
?as_tibble
as_tibble(B)
B
lapply(as.data.frame, B)
lapply(B, as.data.frame)
C <- lapply(B, as.data.frame)
View(C)
bind_rows(C)
D <- bind_rows(C)
View(D)
View(C)
pivot_longer(C)
D <- do.call(pivot_longer, C)
tibble(C)
D <- tibble(C)
View(D)
View(D[[1]][[1]])
View(D[[1]][[2]])
pivot_longer(C)
pivot_londer(D)
pivot_longer(D)
pivot_longer(D, cols = C)
E <- pivot_longer(D)
E <- pivot_longer(D, cols = C)
View(E)
E <- pivot_longer(D, cols = A$Distribution)
C <- as_tibble(C)
df <- bind_cols(C)
library(purrr)
?walk
purrr::walk(A$Model, coef)
C <- purrr::walk(A$Model, coef)
View(C)
C[["Exponential"]]
View(C)
C[["Exponential"]][["coefficients"]]
View(A)
View(A[[3]][[1]])
C <- purrr::walk(A$Model, .get_attribute, "coefficients")
View(C)
C <- purrr::map(A$Model, .get_attribute, "coefficients")
View(C)
?mutate
C <- purrr::map(A$Model, .get_attribute, "coefficients")
View(C)
names(B)
B[1]
B[2]
B[2][1]
B[2][[1]]
B[[1]]
B[[2]]
B[[2]][1]
B[[2]][1][1]
B[[2]][1][2]
B[[2]][1]
unnest(B)
unnest(B, cols = c("Model"))
?nest
A <- A |>
purrr::map(A$Model, .get_attribute, "coefficients")
A <- A |>
purrr::map(Model, .get_attribute, "coefficients")
A <- A |>
purrr::map(.data$Model, .get_attribute, "coefficients")
A <- A |>
purrr::map(.x$Model, .get_attribute, "coefficients")
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
A <- A |>
nest(purrr::map(, .get_attribute, "coefficients"))
A <- A |>
nest(purrr::map(Model, .get_attribute, "coefficients"))
A <- A |>
nest(Coefs = purrr::map(Model, .get_attribute, "coefficients"))
A <- A |>
nest(Coefs = purrr::map(A$Model, .get_attribute, "coefficients"))
B <- coef(A)
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
plot(A, km = TRUE)
B <- coef(A)
A$Coefs <- nest(B)
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
A <- A |>
mutate(Coefs = purrr::map(Model, .get_attribute, "coefficients"))
View(B)
View(A)
as.data.frame(A$Coefs)
pivot_longer(A$Coefs)
tibble(A)
stack(A$Coefs)
B
stack(B)
?stack
stack(B, "Model")
C <- data.frame(stack(B))
C
names(C) <- c("Value", "Distribution")
C
B
C
C$Value
B
nice_parametric_paramlist <- c(
"rate",
"shape",
"rate",
"mu",
"sigma",
"Q",
"shape",
"rate",
"shape",
"scale",
"meanlog",
"sdlog",
"shape",
"scale")
C
nice_parametric_paramlist <- c(
"rate",
"shape",
"rate",
"mu",
"sigma",
"Q",
"shape",
"rate",
"shape",
"scale",
"meanlog",
"sdlog",
"shape",
"scale")
C$term <- nice_parametric_paramlist
C
devtools::load_all()
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
plot(A, km = TRUE)
B <- coef(A)
A
View(A[[3]][[1]])
devtools::load_all()
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
B <- coef(A)
devtools::load_all()
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
B <- coef(A)
A
fit <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
coefList <- purrr::map(fit$Model, .get_attribute, "coefficients")
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
fit <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
A<- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
class(A)
devtools::load_all()
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
B <- coef(A)
coef.fitted_distribution(A)
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
devtools::load_all()
B <- coef(A)
# Load all IPD data
handle_IPD <- function(){
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
}
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
B <- coef(A)
library(sloop)
sloop::s3_dispatch(coef(A))
B <- coef(A)
B <- coef.fitted_distribution(A)
View(B)
gc()
devtools::load_all()
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
s3_dispatch(coef(A))
B <- coef.fitted_distribution(A)
B <- coef(A)
s3_dispatch(plot(A))
B <- coef(A)
ftype(coef)
devtools::load_all()
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
system("python3 src/IPD_handler.py")
for (i in list.files("Data/IPD/", pattern = ".csv")) {
assign(
stringr::str_remove(i, ".csv"),
read.csv(paste0("Data/IPD/",i)) |>
dplyr::mutate(status = ifelse(censored == TRUE, 0, 1))
)
}
A <- fit_distribution(nice_parametric_dists, IPD_GemOS_Colluci)
plot(A, km = TRUE)
B <- coef(A)
inherits(A, "fitted_distributions")
inherits(A, "fitted_distribution")
library(flexsurvreg)
library(flexsurv)
s3_dispatch(coef(A))
devtools::load_all()
?coef.flexsurvreg
A$Model[1]
View(A)
View(A[[3]][[1]])
.get_attribute(A$Model[[2]], "coefficients")
B <- coef(A)
devtools::load_all()
B <- coef(A)
methods(A)
B <- coef.fitted_distribution(A)
B <- coef.fitted_distribution(A)
